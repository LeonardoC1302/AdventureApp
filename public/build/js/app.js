let step=1;const start=1,end=3,reservation={id:"",name:"",date:"",time:"",activities:[]};function startApp(){showSection(),tabs(),pagination(),next(),prev(),checkAPI(),clientId(),clientName(),addDate(),addTime(),showSummary()}function showSection(){const e=document.querySelector(".show");e&&e.classList.remove("show");const t="#step"+step;document.querySelector(t).classList.add("show");const n=document.querySelector(".active");n&&n.classList.remove("active");document.querySelector(`[data-step="${step}"]`).classList.add("active")}function tabs(){document.querySelectorAll(".tabs button").forEach(e=>{e.addEventListener("click",e=>{step=parseInt(e.target.dataset.step),showSection(),pagination()})})}function pagination(){const e=document.querySelector("#prev"),t=document.querySelector("#next");1===step?(t.classList.remove("hide"),e.classList.add("hide")):3===step?(e.classList.remove("hide"),t.classList.add("hide"),showSummary()):(e.classList.remove("hide"),t.classList.remove("hide")),showSection()}function next(){document.querySelector("#next").addEventListener("click",()=>{step>=3||(step++,pagination())})}function prev(){document.querySelector("#prev").addEventListener("click",()=>{step<=1||(step--,pagination())})}async function checkAPI(){try{const e="http://localhost:3000/api/activities",t=await fetch(e);showActivities(await t.json())}catch(e){console.log(e)}}function showActivities(e){e.forEach(e=>{const{id:t,name:n,description:a,price:i}=e,o=document.createElement("P");o.classList.add("activity-name"),o.textContent=n;const c=document.createElement("P");c.classList.add("activity-description"),c.classList.add("hidden"),c.textContent=a;const s=document.createElement("P");s.classList.add("activity-price"),s.textContent="$"+i;const r=document.createElement("DIV");r.classList.add("activity"),r.dataset.idActivity=t,r.onclick=function(){selectActivity(e)},r.appendChild(o),r.appendChild(c),r.appendChild(s),document.querySelector("#activities").appendChild(r)})}function selectActivity(e){const{id:t}=e,{activities:n}=reservation,a=document.querySelector(`[data-id-activity="${t}"]`);n.some(e=>e.id===t)?(reservation.activities=n.filter(e=>e.id!==t),a.classList.remove("selected")):(reservation.activities=[...n,e],a.classList.add("selected"))}function clientId(){reservation.id=document.querySelector("#id").value}function clientName(){reservation.name=document.querySelector("#name").value}function addDate(){const e=document.querySelector("#date");e.addEventListener("input",t=>{const n=new Date(t.target.value).getUTCDay();[0].includes(n)?(e.value="",showAlert("We are not open on Sundays","error",".form")):reservation.date=t.target.value})}function addTime(){const e=document.querySelector("#time");e.addEventListener("input",t=>{const n=t.target.value,a=n.split(":")[0];a<8||a>18?(e.value="",showAlert("We are not open at this time","error",".form")):reservation.time=n})}function showAlert(e,t,n,a=!0){const i=document.querySelector(".alert");i&&i.remove();const o=document.createElement("DIV");o.textContent=e,o.classList.add("alert"),o.classList.add(t);document.querySelector(n).appendChild(o),a&&setTimeout(()=>{o.remove()},3e3)}function showSummary(){const e=document.querySelector(".summary-content");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(reservation).includes(""))showAlert("You must fill all the fields","error",".summary-content",!1);else if(0===reservation.activities.length)showAlert("You must select at least one activity","error",".summary-content",!1);else{const{name:t,date:n,time:a,activities:i}=reservation,o=document.createElement("P");o.innerHTML="<span>Name: </span>"+t;const c=new Date(n),s=c.getMonth(),r=c.getDate()+2,d=c.getFullYear(),l={weekday:"long",year:"numeric",month:"long",day:"numeric"},m=new Date(Date.UTC(d,s,r)).toLocaleDateString("en-US",l),u=document.createElement("P");u.innerHTML="<span>Date: </span>"+m;const p=document.createElement("P");p.innerHTML="<span>Time: </span>"+a;const v=document.createElement("H3");v.textContent="Activities Summary",e.appendChild(v),total=0,i.forEach(t=>{const{id:n,name:a,price:i}=t,o=document.createElement("DIV");o.classList.add("activity-container");const c=document.createElement("P");c.textContent=a;const s=document.createElement("P");s.innerHTML="<span>Price: </span>$"+i,total+=parseFloat(i),o.appendChild(c),o.appendChild(s),e.appendChild(o)});const h=document.createElement("P");h.classList.add("total"),h.innerHTML="<span>Total Price: </span>$"+total.toFixed(2),e.appendChild(h);const y=document.createElement("H3");y.textContent="Reservation Summary",e.appendChild(y);const f=document.createElement("BUTTON");f.classList.add("button"),f.textContent="Make Reservation",f.onclick=makeReservation,e.appendChild(o),e.appendChild(u),e.appendChild(p),e.appendChild(f)}}async function makeReservation(){const{name:e,date:t,time:n,activities:a,id:i}=reservation,o=a.map(e=>e.id),c=new FormData;c.append("userId",i),c.append("date",t),c.append("time",n),c.append("activities",o);try{const e="http://localhost:3000/api/reservations",t=await fetch(e,{method:"POST",body:c});(await t.json()).result&&Swal.fire({icon:"success",title:"Reservation Created",text:"Your reservation has been created successfully",button:"OK",background:"#e3e3c9",color:"#221906",confirmButtonColor:"#8d6b2b"}).then(()=>{setTimeout(()=>{window.location.reload()},1500)})}catch(e){Swal.fire({icon:"error",title:"Error",text:"Something went wrong, try again",background:"#e2e1b5",color:"#221906",confirmButtonColor:"#8d6b2b"})}}document.addEventListener("DOMContentLoaded",()=>{startApp()});